
	DECLARE num_row integer;
    DECLARE tot_rows integer;
    
SELECT COUNT(*)
	INTO tot_rows
    FROM Grades
    WHERE Courses_has_Students_Courses_idCourses=NEW.Courses_has_Students_Courses_idCourses AND
		Courses_has_Students_Students_idStudents=NEW.Courses_has_Students_Students_idStudents;
		
    SELECT COUNT(*)
	INTO num_row
    FROM averages
    WHERE Courses_has_Students_Courses_idCourses=NEW.Courses_has_Students_Courses_idCourses AND
		Courses_has_Students_Students_idStudents=NEW.Courses_has_Students_Students_idStudents;   
    
    IF num_row > 0 THEN
		UPDATE averages
        SET totalScore = New.Score + totalScore,
			courseAVG = totalScore/(tot_rows+1)
			WHERE Courses_has_Students_Courses_idCourses=NEW.Courses_has_Students_Courses_idCourses AND
				Courses_has_Students_Students_idStudents=NEW.Courses_has_Students_Students_idStudents;   

	ELSE
    INSERT INTO averages
		(Courses_has_Students_Students_idStudents, Courses_has_Students_Courses_idCourses, totalScore, courseAVG)
        VALUES 	(NEW.Courses_has_Students_Students_idStudents, NEW.Courses_has_Students_Courses_idCourses, new.Score, new.Score);
	
    END IF;

		
